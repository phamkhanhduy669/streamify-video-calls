apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: streamify-enterprise-rules
  namespace: monitoring
  labels:
    release: prometheus
    app: kube-prometheus-stack
    app.kubernetes.io/instance: prometheus
spec:
  groups:
  - name: streamify.backend
    rules:
    - alert: BackendDown
      expr: (up{job="streamify-backend-svc", namespace="streamify"} == 0)
        or (absent(up{job="streamify-backend-svc", namespace="streamify"}) == 1)
      for: 1m
      labels:
        severity: critical
      annotations:
        summary: "ðŸ”¥ Backend Streamify Ä‘Ã£ Sáº¬P!"
        description: "KhÃ´ng tÃ¬m tháº¥y Pod backend nÃ o."
    
    - alert: HighLatency
      expr: rate(http_request_duration_seconds_sum[1m]) / rate(http_request_duration_seconds_count[1m]) > 2
      for: 5m
      labels:
        severity: warning
      annotations:
        summary: "âš ï¸ API pháº£n há»“i cháº­m"
        description: "Latency > 2s."
    
    - alert: HighCPUUsage
      expr: sum(rate(container_cpu_usage_seconds_total{namespace="streamify", container="streamify-backend"}[1m])) by (pod) / sum(kube_pod_container_resource_limits{namespace="streamify", container="streamify-backend", resource="cpu"}) by (pod) * 100 > 80
      for: 1m
      labels:
        severity: warning
      annotations:
        summary: "ðŸ”¥CPU sá»­ dá»¥ng cao trÃªn Pod {{ $labels.pod }}"
        description: "Pod {{ $labels.pod }} Ä‘ang dÃ¹ng {{ $value | humanize }}% CPU limit."